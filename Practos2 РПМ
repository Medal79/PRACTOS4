CREATE DATABASE FOOTBALL_SHOP;
GO
USE FOOTBALL_SHOP;
GO

CREATE TABLE roles (
    ID_role INT PRIMARY KEY IDENTITY(1,1),
    [name] VARCHAR(50) NOT NULL UNIQUE
);
GO


CREATE TABLE users (
    ID_user INT PRIMARY KEY IDENTITY(1,1),
    [login] VARCHAR(30) NOT NULL UNIQUE,
    [password] VARCHAR(255) NOT NULL CHECK (LEN([password]) > 3),
    role_ID INT NOT NULL,
    FOREIGN KEY (role_ID) REFERENCES roles(ID_role)
);
GO

CREATE TABLE categories (
    ID_category INT PRIMARY KEY IDENTITY(1,1),
    [name] VARCHAR(50) NOT NULL UNIQUE
);
GO

CREATE TABLE products (
    ID_product INT PRIMARY KEY IDENTITY(1,1),
    [name] VARCHAR(100) NOT NULL,
    [description] VARCHAR(500),
    price DECIMAL(10,2) NOT NULL CHECK (price > 0),
    category_ID INT NOT NULL,
    FOREIGN KEY (category_ID) REFERENCES categories(ID_category),
    quantity INT NOT NULL DEFAULT 0 CHECK (quantity >= 0),
    is_active BIT DEFAULT 1
);
GO

CREATE TABLE cart (
    ID_cart INT PRIMARY KEY IDENTITY(1,1),
    [user_ID] INT NOT NULL UNIQUE,
    FOREIGN KEY ([user_ID]) REFERENCES users(ID_user)
);
GO

CREATE TABLE cart_items (
    ID_cart_item INT PRIMARY KEY IDENTITY(1,1),
    ID_cart INT NOT NULL,
    product_ID INT NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    FOREIGN KEY (ID_cart) REFERENCES cart(ID_cart) ON DELETE CASCADE,
    FOREIGN KEY (product_ID) REFERENCES products(ID_product),
    UNIQUE (ID_cart, product_ID)
);
GO

CREATE TABLE orders (
    ID_order INT PRIMARY KEY IDENTITY(1,1),
    [user_ID] INT NOT NULL,
    order_date DATETIME DEFAULT GETDATE(),
    total_amount DECIMAL(12,2) NOT NULL CHECK (total_amount >= 0),
    FOREIGN KEY ([user_ID]) REFERENCES users(ID_user)
);
GO

CREATE TABLE order_items (
    ID_order_item INT PRIMARY KEY IDENTITY(1,1),
    order_ID INT NOT NULL,
    product_ID INT NOT NULL,
    [name] VARCHAR(100) NOT NULL,
    price_at_order DECIMAL(10,2) NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    subtotal AS (price_at_order * quantity),
    FOREIGN KEY (order_ID) REFERENCES orders(ID_order) ON DELETE CASCADE,
    FOREIGN KEY (product_ID) REFERENCES products(ID_product)
);
GO

